<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞—Ç–∞—Ä–µ–∏ Victron</title>
</head>
<body>
  <h1>üîã –£—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞ –±–∞—Ç–∞—Ä–µ–∏</h1>
  
  <p id="soc">SoC: ...</p>
  <p id="volt">–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ: ...</p>
  <p id="curr">–¢–æ–∫: ...</p>
  <p id="power">–ú–æ—â–Ω–æ—Å—Ç—å: ...</p>
  <p id="inverter_power">–ú–æ—â–Ω–æ—Å—Ç—å 2: ...</p>
  <p id="soh">SOH: ...</p>

  <script>
    async function fetchStatus() {
      try {
        const res = await fetch('/api/modbus/battery_status');
        const data = await res.json();
        document.getElementById('soc').innerText = `üîã SoC: ${data.soc}%`;
        document.getElementById('volt').innerText = `üîå –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ: ${data.voltage} –í`;
        document.getElementById('curr').innerText = `‚ö° –¢–æ–∫: ${data.current} –ê`;
        document.getElementById('power').innerText = `üí° –ú–æ—â–Ω–æ—Å—Ç—å: ${data.power} –í—Ç`;
        document.getElementById('soh').innerText = `‚ù§Ô∏è SOH: ${data.soh}%`;
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –±–∞—Ç–∞—Ä–µ–∏:", err);
      }
    }

    async function fetchInverter() {
      try {
        const res = await fetch('/api/modbus/inverter_power');
        const data = await res.json();
        document.getElementById('inverter_power').innerText = `‚öôÔ∏è –ú–æ—â–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Ä—Ç–æ—Ä–∞: ${data.inverter_power} –í—Ç`;
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–æ—â–Ω–æ—Å—Ç–∏ –∏–Ω–≤–µ—Ä—Ç–æ—Ä–∞:", err);
      }
    }

    // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    fetchStatus();
    fetchInverter();

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    setInterval(fetchStatus, 3000);      // –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    setInterval(fetchInverter, 2100);     // –∏–Ω–≤–µ—Ä—Ç–æ—Ä ‚Äî —á–∞—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã)
  </script>
</body>
</html>
