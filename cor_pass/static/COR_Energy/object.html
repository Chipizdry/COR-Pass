





<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
      <!-- Favicon SVG (основной) -->
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    
      <!-- Fallback для старых браузеров -->
    <link rel="alternate icon" href="/static/favicon.png" type="image/png">
      
      <!-- Для Safari -->
    <link rel="mask-icon" href="/static/favicon.svg" color="#291161">
    <link rel="stylesheet" href="/static/COR_ID_css/styles.css">
    <link rel="stylesheet" type="text/css" href="/static/COR_ID_css/modal.css">
    <link rel="stylesheet" href="/static/COR_Energy/energy.css">

    <title>COR-Energy</title>
    <script src="/static/COR_Energy/scripts.js"></script>
    <script src="/static/COR_Energy/power-settings.js"></script>
    <script src="/static/COR_Energy/chart.js"></script>
    <script src="/static/COR_Energy/line_chart.js"></script>
    <script src="/static/COR_Energy/chart_settings.js"></script>
    <script src="/static/COR_Energy/timetable.js"></script>
    <script src="/static/COR_ID_Js/general_fun.js"></script>
    <script src="/static/COR_Energy/xlsx.full.min.js"></script>
    <script src="/static/COR_Energy/chart.min.js"></script>


</head>
<body>
    <div class="energy-container">
    
        <div class="connection-status">
            <span id="connectionIndicator" class="status-indicator"></span>
            Соединение с сервером 
        </div>
             
        <button class="link-button" onclick="goBack('/static/COR_ID/mainscreen.html')" data-translate="back-link-text"><<<назад<<<</button>
        <h3>COR-Energy Трасса E-95</h3>


        <!-- Вкладки -->
        <div class="tabs">
            <div class="tab active" onclick="openTab(event, 'control')">Управление</div>
            <div class="tab" onclick="openTab(event, 'monitor')">Мониторинг</div>
            <div class="tab" onclick="openTab(event, 'timetable')">Расписание</div>        
            <div class="tab" onclick="openTab(event, 'settings')">Настройки</div>
        </div>

		 <!-- Вкладка Управление -->
<div id="control" class="tabcontent active">
    
             <!-- Иконка батареи -->
             <div class="icon battery-icon" id="batteryIcon">
                <div id="batteryFlowLabel" style="text-align: center; margin-bottom: -20px; font-size: 14px; font-weight: bold;">
                    Заряд/Разряд батареи
                </div>
                  <svg width="140" height="69" viewBox="0 0 80 39" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M73.0562 6.28855C73.3817 6.28855 73.6465 6.55336 73.6465 6.87884V31.8644C73.6465 32.1899 
                    73.3817 32.4547 73.0562 32.4547H14.7964C14.4709 32.4547 14.2061 32.1899 14.2061 31.8644V6.87884C14.2061 
                    6.55336 14.4709 6.28855 14.7964 6.28855H73.0562ZM73.0562 3.98086H14.7964C13.1959 3.98086 11.8984 
                    5.27833 11.8984 6.87884V31.8644C11.8984 33.4649 13.1959 34.7624 14.7964 34.7624H73.0562C74.6567 
                    34.7624 75.9542 33.4649 75.9542 31.8644V6.87884C75.9542 5.27833 74.6567 3.98086 73.0562 3.98086Z" fill="#5B4296"/>
                    <path d="M73.462 0H14.4617C10.8509 0 7.92377 2.92715 7.92377 6.53797V8.76876H3.93547C1.76196 8.76876 0 10.5307 0 
                    12.7042V26.0395C0 28.213 1.76196 29.975 3.93547 29.975H7.92377V32.2058C7.92377 35.8166 10.8509 38.7438 14.4617 
                    38.7438H73.462C77.0729 38.7438 80 35.8166 80 32.2058V6.53797C80 2.92715 77.0729 0 73.462 0ZM7.91572 27.6673H3.93547C3.03792 
                    27.6673 2.30769 26.9371 2.30769 26.0395V12.7042C2.30769 11.8067 3.03792 11.0764 3.93547 11.0764H7.91572V27.6673ZM77.6923 
                    32.2058C77.6923 34.5384 75.7946 36.4361 73.462 36.4361H14.4617C12.1292 36.4361 10.2315 34.5384 10.2315 32.2058V6.53797C10.2315 
                    4.2054 12.1292 2.30769 14.4617 2.30769H73.462C75.7946 2.30769 77.6923 4.2054 77.6923 6.53797V32.2058Z" fill="#5B4296"/>
                  </svg>

            </div>



               <!-- Иконка солнечной батареи -->
               <div class="icon solar-battery-icon" id="SolarBatteryIcon">
                <div id="solarPowerLabel" style="text-align: center; margin-bottom: 4px; font-size: 14px; font-weight: bold;">Мощность: 0 Вт</div>
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                width="240.000000pt" height="190.000000pt" viewBox="0 0 512.000000 512.000000" style="border: 0px solid red"
                preserveAspectRatio="xMidYMid meet">
                <rect x="0" y="20" width="550" height="50" rx="0" ry="0" stroke="#333333" stroke-width="2" fill="#fff"></rect>
                <rect id="solarPowerIndicator" x="0" y="20" width="0" height="50" rx="0" ry="0" fill="green"></rect>
           
                <g transform="translate(-80.000000,512.000000) scale(0.1300000,-0.100000)" fill="#000000" stroke="none">
                <path d="M2465 4098 c-11 -6 -23 -16 -27 -22 -4 -6 -8 -75 -8 -153 0 -130 2
                -145 20 -163 25 -25 61 -26 91 -1 22 18 24 27 27 137 4 138 -7 190 -44 204
                -31 12 -34 12 -59 -2z"/>
                <path d="M1550 3740 c-25 -25 -26 -61 -2 -88 23 -26 225 -152 244 -152 28 0
                68 40 68 69 0 39 -13 51 -128 125 -111 71 -147 81 -182 46z"/>
                <path d="M3252 3689 c-83 -53 -114 -78 -119 -97 -8 -33 15 -74 49 -86 23 -8
                41 0 143 64 63 40 120 81 125 91 25 46 -6 99 -58 99 -18 0 -70 -27 -140 -71z"/>
                <path d="M2430 3544 c-258 -50 -459 -280 -460 -526 0 -38 5 -50 26 -67 35 -27
                59 -26 89 4 18 17 25 35 25 64 0 58 34 157 74 215 146 212 461 233 633 42 59
                -65 89 -131 105 -230 11 -65 18 -82 39 -98 34 -25 75 -15 94 23 12 23 13 42 5
                98 -38 272 -248 465 -519 476 -48 2 -97 1 -111 -1z"/>
                <path d="M1436 3054 c-43 -43 -22 -108 38 -119 18 -4 86 -5 151 -3 109 3 118
                5 136 27 25 30 24 66 -1 91 -18 18 -33 20 -164 20 -118 0 -147 -3 -160 -16z"/>
                <path d="M3336 3054 c-43 -43 -22 -108 38 -119 18 -4 86 -5 151 -3 109 3 118
                5 136 27 25 30 24 66 -1 91 -18 18 -33 20 -164 20 -118 0 -147 -3 -160 -16z"/>
                <path d="M1216 2628 c-23 -20 -51 -116 -231 -785 -217 -805 -215 -796 -166
                -822 14 -8 547 -11 1743 -11 1872 0 1757 -3 1772 53 7 29 -484 1541 -509 1566
                -14 15 -135 16 -1300 19 l-1284 2 -25 -22z m591 -155 c-3 -21 -11 -77 -18
                -125 l-12 -88 -268 0 -267 0 24 88 c13 48 29 104 35 125 l10 37 251 0 251 0
                -6 -37z m683 -88 l0 -125 -286 0 -287 0 6 38 c3 20 11 76 18 125 l12 87 269 0
                268 0 0 -125z m647 30 c6 -49 14 -105 17 -122 l5 -33 -265 0 -264 0 0 125 0
                125 248 -2 247 -3 12 -90z m631 -27 l39 -123 -250 -3 c-138 -1 -252 0 -254 2
                -6 5 -33 191 -33 224 l0 22 230 0 229 0 39 -122z m-2019 -300 c0 -18 -12 -114
                -27 -213 l-27 -180 -303 -3 c-286 -2 -303 -1 -298 15 3 10 26 97 52 193 25 96
                50 184 55 197 l9 23 270 0 270 0 -1 -32z m741 -183 l0 -215 -325 0 c-271 0
                -325 2 -325 14 0 17 49 363 55 394 l5 22 295 0 295 0 0 -215z m685 203 c6 -16
                55 -373 55 -399 0 -18 -11 -19 -300 -19 l-300 0 0 215 0 215 270 0 c207 0 272
                -3 275 -12z m747 -193 c36 -110 67 -206 67 -213 1 -10 -64 -12 -306 -10 l-308
                3 -27 195 c-15 107 -27 203 -27 213 -1 16 16 17 267 15 l267 -3 67 -200z
                m-2252 -383 c0 -9 -11 -96 -25 -192 -14 -96 -25 -178 -25 -182 0 -5 -151 -8
                -335 -8 -261 0 -335 3 -335 13 0 6 18 80 40 162 23 83 45 167 51 188 l10 37
                309 0 c289 0 310 -1 310 -18z m820 -182 l0 -200 -365 0 -366 0 5 33 c3 17 15
                102 27 187 11 85 22 161 24 168 3 9 80 12 340 12 l335 0 0 -200z m790 2 c14
                -106 24 -195 21 -197 -2 -3 -154 -5 -338 -5 l-333 0 0 200 0 200 312 -2 312
                -3 26 -193z m827 -2 c34 -107 63 -196 63 -197 0 -2 -162 -3 -360 -3 l-359 0
                -6 33 c-12 70 -45 323 -45 344 l0 23 322 -2 322 -3 63 -195z"/>
                </g>
           </svg>

            </div>
                   <!-- Иконка инвертора напряжения -->
        
                        <div class="icon inverter-icon" id="inverterIcon">
                  
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="180" height="180" viewBox="0 0 90 90" 
                        style="border: 0px solid red" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(-85,85) scale(0.1,-0.1)" fill="#000000" stroke="none">
                            <path d="M921 826 c-49 -27 -50 -37 -51 -404 0 -372 2 -386 
                            55 -410 41 -19 697 -17 734 2 49 26 51 41 51 406 0 365 -2 
                            380 -51 406 -39 20 -702 20 -738 0z m709 -33 c0 -10 -703 
                            -713 -712 -713 -5 0 -8 153 -8 340 0 327 1 341 20 360 19 19 
                            33 20 360 20 187 0 340 -3 340 -7z m40 -373 c0 -327 -1 -341 
                            -20 -360 -19 -19 -33 -20 -360 -20 -187 0 -340 3 -340 7 0 10 
                            703 713 712 713 5 0 8 -153 8 -340z"/>
                            <path d="M1025 690 c-12 -4 -27 -15 -35 -25 -20 -25 7 -39 37 
                            -20 35 23 64 18 111 -20 24 -19 53 -37 64 -41 50 -15 144 33 
                            108 56 -10 6 -23 4 -37 -5 -33 -22 -65 -18 -103 13 -63 52 -97 62 -145 42z"/>
                            <path d="M1290 260 c0 -19 7 -20 140 -20 133 0 140 1 140 20 0 19 -7 20 -140 20 -133 0 -140 -1 -140 -20z"/>
                            <path d="M1290 180 c0 -18 7 -20 60 -20 53 0 60 2 60 20 0 18 -7 20 -60 20 -53 0 -60 -2 -60 -20z"/>
                            <path d="M1450 180 c0 -18 7 -20 60 -20 53 0 60 2 60 20 0 18 -7 20 -60 20 -53 0 -60 -2 -60 -20z"/>
                        </g>
                    </svg>
           
        </div>
        <!-- Иконка сети электропитания -->
          <div class="icon power-grid-icon" id="power-grid-icon">
            <div id="networkFlowLabel" style="text-align: center; margin-bottom: 4px; font-size: 14px; font-weight: bold;">
                Состояние сети
              </div>
              <svg width="140" height="140" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M72.9408 40.029L62.4837 34.9164C62.328 34.832 62.1352 34.8002 62.019 34.8002H47.4947L45.0546 
                20.0431H57.371V21.9023H57.0224C56.3252 21.9023 55.8605 22.3671 55.8605 23.0642V27.1311C55.8605 27.8283 
                56.3252 28.2931 57.0224 28.2931H59.9273C60.6244 28.2931 61.0892 27.8283 61.0892 27.1311V23.0642C61.0892 
                22.3671 60.6244 21.9023 59.9273 21.9023H59.6949V20.0431H63.297C63.878 20.0431 64.3427 19.6946 64.4589 
                19.1136C64.5752 18.5326 64.3427 18.0679 63.7618 17.8354L52.1422 12.7228C52.0098 12.6567 51.9098 12.6066 
                51.6774 12.6066H43.6962L40.9085 0.723637C40.7904 0.241515 40.3884 -4.53826e-05 39.9862 6.39522e-09C39.5864 
                4.53954e-05 39.1864 0.238837 39.0659 0.717373L36.2029 12.6066H28.2062C28.09 12.6066 27.8885 12.6408 
                27.7414 12.7228L16.1219 17.8354C15.6571 18.0678 15.3084 18.6488 15.4247 19.1136C15.5409 19.6946 
                16.0057 20.0431 16.5866 20.0431H20.1888V21.9023H19.8402C19.143 21.9023 18.6782 22.3671 18.6782 
                23.0642V27.1311C18.6782 27.8283 19.143 28.2931 19.8402 28.2931H22.745C23.4422 28.2931 23.907 
                27.8283 23.907 27.1311V23.0642C23.907 22.3671 23.4422 21.9023 22.745 21.9023H22.5126V20.0431H34.829L32.3889 
                34.8002H17.8647C17.6323 34.8002 17.5384 34.855 17.3999 34.9164L6.94262 40.029C6.47784 40.2614 6.24545 
                40.8424 6.36164 41.3072C6.47784 41.8882 6.94262 42.2368 7.5236 42.2368H9.84752V44.2121H9.0341C8.33692 
                44.2121 7.87214 44.6768 7.87214 45.374C7.87214 46.0712 8.33692 46.536 9.0341 46.536H9.73127V47.3494H8.33693C7.63975 
                47.3494 7.17497 47.8142 7.17497 48.5113C7.17497 49.2085 7.63975 49.6733 8.33693 49.6733H13.5657C14.2629 49.6733 
                14.7276 49.2085 14.7276 48.5113C14.7276 47.8142 14.2629 47.3494 13.5657 47.3494H12.0552V46.536H12.7524C13.4495 
                46.536 13.9143 46.0712 13.9143 45.374C13.9143 44.6768 13.4495 44.2121 12.7524 
                44.2121H12.0552V42.2368H22.5124V44.2121H21.8153C21.1181 44.2121 20.6533 44.6768 20.6533 45.374C20.6533 
                46.0712 21.1181 46.536 21.8153 46.536H22.5124V47.3494H21.1181C20.4209 47.3494 19.9561 47.8142 19.9561 
                48.5113C19.9561 49.2085 20.4209 49.6733 21.1181 49.6733H26.3469C27.044 49.6733 27.5088 49.2085 27.5088 
                48.5113C27.5088 47.8142 27.044 47.3494 26.3469 47.3494H24.8364V46.536H25.5335C26.2307 46.536 26.6955 
                46.0712 26.6955 45.374C26.6955 44.6768 26.2307 44.2121 25.5335 44.2121H24.8364V42.2368H31.2272L26.2307 
                73.1445H25.3011C22.9772 73.1445 21.1181 75.0036 21.1181 77.3275V78.838C21.1181 79.5352 21.5829 80 
                22.2801 80H57.7196C58.4168 80 58.8815 79.5352 58.8815 78.838V77.3275C58.8815 75.0036 57.0224 
                73.1445 54.6985 73.1445H53.7689L48.7725 42.2368H55.047V44.2121H54.3499C53.6527 44.2121 53.1879 
                44.6768 53.1879 45.374C53.1879 46.0712 53.6527 46.536 54.3499 46.536H55.047V47.3494H53.6527C52.9555 
                47.3494 52.4907 47.8142 52.4907 48.5113C52.4907 49.2085 52.9555 49.6733 53.6527 49.6733H58.8815C59.5786 
                49.6733 60.0434 49.2085 60.0434 48.5113C60.0434 47.8142 59.5786 47.3494 58.8815 47.3494H57.3709V46.536H58.0681C58.7653 
                46.536 59.2301 46.0712 59.2301 45.374C59.2301 44.6768 58.7653 44.2121 58.0681 
                44.2121H57.3709V42.2368H67.8282V44.2121H67.131C66.4339 44.2121 65.9691 44.6768 65.9691 45.374C65.9691 
                46.0712 66.4339 46.536 67.131 46.536H67.8282V47.3494H66.4339C65.7367 47.3494 65.2719 47.8142 65.2719 
                48.5113C65.2719 49.2085 65.7367 49.6733 66.4339 49.6733H71.6626C72.3598 49.6733 72.8246 49.2085 72.8246 
                48.5113C72.8246 47.8142 72.3598 47.3494 71.6626 47.3494H70.1521V46.536H70.8493C71.5465 46.536 72.0113 
                46.0712 72.0113 45.374C72.0113 44.6768 71.5465 44.2121 70.8493 44.2121H70.1521V42.2368H72.476C73.057 
                42.2368 73.5218 41.8882 73.638 41.3072C73.7542 40.8424 73.5218 40.2615 72.9408 40.029ZM47.843 
                51.2998L41.4523 43.7473L45.7515 38.6347L47.843 51.2998ZM39.9418 61.9897L31.9244 55.1341L39.9418 
                45.6064L47.9591 55.1341L39.9418 61.9897ZM39.943 65.0112L49.5875 73.1452H30.2986L39.943 65.0112ZM45.0549 
                35.846L39.9423 42.0043L34.8297 35.846L39.9423 27.3638L45.0549 35.846ZM41.917 14.9307L42.2656 17.7194H37.6178L38.0826 
                14.9307H41.917ZM43.079 22.1348L44.3572 30.1522L41.3361 25.0396L43.079 22.1348ZM39.9416 22.832L38.315 
                20.0433H41.6846L39.9416 22.832ZM38.5474 25.0398L35.5263 30.1524L36.8044 22.1351L38.5474 25.0398ZM58.3005 
                24.2265H58.8815V25.9695H58.3005V24.2265ZM51.4455 14.9307L57.7201 17.7194H44.7062L44.2414 14.9307H51.4455ZM39.9701 
                6.49158L41.4046 12.6066H38.4976L39.9701 6.49158ZM21.6988 25.9695H21.1179V24.2265H21.6988V25.9695ZM22.1645 
                17.7194L28.4391 14.9307H35.6432L35.1785 17.7194H22.1645ZM34.132 38.6347L38.4312 43.7473L32.1566 51.2998L34.132 
                38.6347ZM12.4041 39.913L18.0976 37.1243H32.0411L31.5764 39.913H12.4041ZM31.1114 57.4587L38.1993 63.5009L28.9037 
                71.4022L31.1114 57.4587ZM54.6994 75.4691C55.6289 75.4691 56.5585 76.3987 56.5585 77.4444V77.6768H23.4429V77.3282C23.4429 
                76.2825 24.2563 75.4691 25.302 75.4691H54.6994ZM48.7733 57.4586L51.0972 71.4021L41.6854 63.5008L48.7733 57.4586ZM48.3085 
                39.9129L47.8438 37.1242H61.7873L67.4808 39.9129H48.3085Z" fill="#5B4296"/>
              </svg>

           
           
        </div>


            <!-- Иконка нагрузки -->
            <div class="icon power-icon" id="loadIcon">
                <div id="loadIndicatorLabel" style="text-align: center; margin-bottom: -16px; font-size: 14px; font-weight: bold;">
                    Состояние сети
                  </div>
               <svg width="140" height="140" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M39.9983 12.3068C28.1842 12.3068 18.5725 21.7883 18.5725 33.4427C18.5725 39.8333 22.9626 46.064
                     24.3011 47.8121C27.1212 51.7117 28.8542 55.1654 29.3134 57.7996C29.3317 57.9049 29.3678 58.2044 29.4039 
                     59.0256C29.4337 59.6983 29.9846 60.2255 30.6582 60.2255H49.3453C50.0126 60.2255 50.5632 59.7041 50.599 
                     59.0389C50.6387 58.2937 50.6877 57.7509 50.737 57.5104C51.2714 54.8824 53.0315 51.4393 55.6901 
                     47.819C57.4141 45.5327 61.4238 39.5545 61.4238 33.4427C61.4238 21.7883 51.8124 12.3068 39.9983 
                     12.3068ZM59.1134 33.3704C59.1134 39.2365 53.8936 46.3629 53.8407 46.4342L53.8398 46.4357C51.5926 
                     49.5 48.8215 53.9761 48.3662 57.9151H31.7022C31.3471 54.8713 29.5579 51.1175 26.2275 46.4336C26.1739 
                     46.3617 20.8829 39.1648 20.8829 33.3704C20.8829 22.9898 29.458 14.5446 39.9983 14.5446C50.5386 14.5446 
                     59.1134 22.9898 59.1134 33.3704Z" fill="#5B4296"/>
                    <path d="M45.0659 31.8533H34.9307C34.6925 31.8533 34.4995 32.0462 34.4995 32.2843V33.7323C34.4995 33.9704 
                    34.6925 34.1633 34.9307 34.1633H38.8429V48.2111C38.8429 48.4493 39.036 48.6423 39.2742 
                    48.6423H40.7221C40.9603 48.6423 41.1533 48.4493 41.1533 48.2111V34.1633H45.0659C45.3041 34.1633 45.4971 
                    33.9704 45.4971 33.7323V32.2843C45.4971 32.0462 45.3041 31.8533 45.0659 31.8533Z" fill="#5B4296"/>
                    <path d="M45.066 28.2336H34.9305C34.6925 28.2336 34.4995 28.4266 34.4995 28.6647V30.1126C34.4995 
                    30.3507 34.6925 30.5437 34.9305 30.5437H45.066C45.3041 30.5437 45.4971 30.3507 45.4971 
                    30.1126V28.6647C45.4971 28.4266 45.3041 28.2336 45.066 28.2336Z" fill="#5B4296"/>
                    <path d="M47.2043 68.0951H32.8693C31.6809 68.0951 30.6206 68.8147 30.2302 69.8859C29.922 70.7315 
                    30.0402 71.6381 30.5544 72.373C31.0731 73.114 31.9094 73.5564 32.792 73.5564H47.127C48.3151 73.5564 
                    49.3757 72.8367 49.766 71.7659C50.0742 70.92 49.9561 70.0134 49.4416 69.2784C48.9231 68.5375 48.0868 
                    68.0951 47.2043 68.0951ZM47.133 71.3801H32.8633C32.654 71.3801 32.4654 71.2962 32.3587 71.1555C32.1879 
                    70.9296 32.2285 70.7281 32.2928 70.5988C32.3902 70.4031 32.5908 70.2717 32.792 70.2717H47.2043C47.4054 
                    70.2717 47.606 70.4031 47.7034 70.5988C47.7678 70.7281 47.8084 70.9296 47.6376 71.1552C47.5308 71.2962 
                    47.3423 71.3801 47.133 71.3801Z" fill="#5B4296"/>
                    <path d="M48.5181 61.6515H31.5555C30.3674 61.6515 29.3068 62.3711 28.9164 63.4419C28.6082 64.2878 28.7264 
                    65.1945 29.2406 65.9294C29.7593 66.6704 30.5956 67.1127 31.4782 67.1127H48.4408C49.6289 67.1127 50.6895 
                    66.3931 51.0801 65.322C51.3884 64.4764 51.2702 63.57 50.756 62.8351C50.2372 62.0942 49.4007 61.6515 
                    48.5181 61.6515ZM49.0172 64.609C48.9198 64.8048 48.7192 64.9362 48.5181 64.9362H31.5492C31.3399 64.9362 
                    31.1513 64.8523 31.0449 64.7119C30.8741 64.486 30.9147 64.2842 30.979 64.1549C31.0764 63.9592 31.277 
                    63.8278 31.4782 63.8278H48.4471C48.6564 63.8278 48.8449 63.9117 48.9514 64.0524C49.1222 64.2782 
                    49.0816 64.4797 49.0172 64.609Z" fill="#5B4296"/>
                    <path d="M39.9992 5.92962C40.0299 5.92962 40.0608 5.92872 40.0918 5.92662C40.6869 5.88782 41.1533 5.38173 
                    41.1533 4.77459V1.15491C41.1533 0.547475 40.6869 0.0415268 40.0918 0.00288522C39.7424 -0.0192171 39.423 
                    0.0861825 39.193 0.301342C38.9674 0.512893 38.8429 0.816011 38.8429 1.15491V4.77459C38.8429 5.11349 
                    38.9674 5.41661 39.193 5.62816C39.4023 5.82422 39.6858 5.92962 39.9992 5.92962Z" fill="#5B4296"/>
                    <path d="M11.8943 34.5373C12.1093 34.3077 12.2152 33.9885 12.1926 33.6386C12.1535 33.0435 11.6477 32.5773 
                    11.0406 32.5773H7.42093C6.81379 32.5773 6.30769 33.0434 6.2686 33.6388C6.24605 33.9888 6.3522 34.308 
                    6.56751 34.5374C6.77891 34.7631 7.08203 34.8873 7.42093 34.8873H11.0406C11.3795 34.8873 11.6826 
                    34.763 11.8943 34.5373Z" fill="#5B4296"/>
                    <path d="M73.4288 32.927C73.2174 32.7015 72.9143 32.5773 72.5757 32.5773H68.9557C68.3486 32.5773 
                    67.8428 33.0434 67.8037 33.6388C67.7811 33.9888 67.8873 34.308 68.1026 34.5376C68.314 34.7631 68.6171 
                    34.8873 68.9557 34.8873H72.5757C73.1828 34.8873 73.6886 34.4212 73.7277 33.8258C73.7503 33.4758 
                    73.6441 33.1566 73.4288 32.927Z" fill="#5B4296"/>
                    <path d="M64.6293 20.8875C64.8759 21.2166 65.2852 21.4047 65.6911 21.4047C65.8469 21.4047 66.0024 
                    21.3769 66.1476 21.3187C66.1612 21.3133 66.1744 21.3073 66.1873 21.3005L69.395 19.623C69.6651 19.4609 
                    69.8614 19.213 69.9477 18.9249C70.04 18.6179 69.9988 18.2957 69.832 18.0181C69.4855 17.4409 68.7807 
                    17.2478 68.2493 17.5682L65.0416 19.2458C64.7716 19.408 64.5752 19.6559 64.4889 19.944C64.3966 20.251 
                    64.4378 20.5731 64.6047 20.851C64.6122 20.8634 64.6206 20.8758 64.6293 20.8875Z" fill="#5B4296"/>
                    <path d="M15.3669 46.5768C15.0253 46.1215 14.3725 45.9354 13.8483 46.1459C13.8348 46.1513 13.8219 
                    46.1573 13.809 46.1642L10.6019 47.8416C10.3315 48.0034 10.1352 48.2514 10.0485 48.5395C9.95623 48.8466 
                    9.99742 49.1686 10.164 49.4465C10.398 49.8359 10.7946 50.05 11.1916 50.05C11.3828 50.05 11.5741 50.0001 
                    11.747 49.8963L14.9547 48.2187C15.5317 47.8722 15.7239 47.1674 15.3919 46.6141C15.3844 46.6011 15.376 
                    46.5888 15.3669 46.5768Z" fill="#5B4296"/>
                    <path d="M10.6019 19.6231C10.6091 19.6275 10.6163 19.6316 10.6238 19.6355L13.787 21.2882C13.9701 
                    21.3981 14.1701 21.4506 14.3683 21.4506C14.7679 21.4506 15.1601 21.2368 15.3919 20.8508C15.4039 
                    20.831 15.4142 20.8104 15.4226 20.7889C15.6322 20.2649 15.4466 19.612 14.9914 19.2706C14.9727 
                    19.2566 14.9532 19.2441 14.9324 19.2333L11.7689 17.5806C11.2156 17.2481 10.5104 17.441 10.164 
                    18.0181C9.83174 18.5719 10.0242 19.2767 10.6019 19.6231Z" fill="#5B4296"/>
                    <path d="M69.3562 47.8927L66.2093 46.2487C65.6563 45.9164 64.9508 46.1088 64.6047 46.6859C64.4378 
                    46.9638 64.3966 47.2858 64.4889 47.5929C64.5752 47.8809 64.7716 48.129 65.0639 48.3037L68.2274 
                    49.9562C68.4108 50.0662 68.6108 50.1189 68.8086 50.1189C69.2086 50.1189 69.6004 49.9047 69.832 4
                    9.5189C70.0076 49.2263 70.0446 48.8688 69.9333 48.538C69.8335 48.2418 69.6242 48.0081 69.3562 
                    47.8927Z" fill="#5B4296"/>
                    <path d="M54.5805 10.1146C54.5922 10.1237 54.6045 10.1319 54.6172 10.1395C54.8054 10.2524 55.0135 
                    10.3066 55.2201 10.3066C55.59 10.3066 55.9559 10.1331 56.1974 9.81122C56.2052 9.801 56.2124 9.79047 
                    56.2191 9.7795L58.1042 6.73403C58.4194 6.20944 58.2783 5.52998 57.7761 5.15379C57.5392 4.97577 
                    57.2138 4.91923 56.8836 4.99772C56.5898 5.06779 56.3258 5.23513 56.1592 5.45691C56.1517 5.46728 
                    56.1445 5.47781 56.1376 5.48878L54.2638 8.51575C54.0966 8.75106 54.0443 9.06816 54.121 
                    9.39008C54.191 9.68417 54.3585 9.9482 54.5805 10.1146Z" fill="#5B4296"/>
                    <path d="M23.7758 9.70477C23.9427 9.98112 24.2037 10.1671 24.5116 10.2288C24.5853 10.2435 
                    24.6599 10.2507 24.7347 10.2507C24.9552 10.2507 25.1777 10.188 25.3789 10.0671C25.9358 9.73318 
                    26.0928 9.0432 25.7412 8.45696L23.8618 5.42157C23.6952 5.14371 23.4333 4.95652 23.1244 
                    4.89487C22.8348 4.83654 22.5269 4.89457 22.2572 5.05651C21.979 5.22325 21.792 5.48517 
                    21.7303 5.79415C21.6723 6.08344 21.7297 6.39152 21.8951 6.66652L23.7758 9.70477Z" fill="#5B4296"/>
                    <path d="M43.7449 74.5391H36.2514C35.8879 74.5391 35.5474 74.7008 35.3174 74.9829C35.088 75.2641 
                    34.998 75.6291 35.0708 75.9843C35.5471 78.3109 37.6197 80 39.9983 80C42.3766 80 44.4491 78.3109 
                    44.9255 75.9843C44.9982 75.6291 44.9083 75.2641 44.6789 74.9829C44.4488 74.7008 44.1084 74.5391 
                    43.7449 74.5391ZM42.2563 76.7153C41.7229 77.4042 40.8938 77.8237 39.9983 77.8237C39.1025 
                    77.8237 38.2734 77.4042 37.7399 76.7153H42.2563Z" fill="#5B4296"/>
                </svg>

        </div>

    <div class="svg-wrapper"> 
        <svg width="540" height="600" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <pattern id="flowLoad" patternUnits="userSpaceOnUse" width="20" height="20">
                    <rect id="loadFlowRect" width="10" height="20" fill="#ffffff"></rect>
                    <animateTransform id="loadFlowAnim" attributeName="patternTransform" type="translate" from="0,0" to="40,0" dur="1s" repeatCount="indefinite"></animateTransform>
              </pattern>
              <pattern id="flowGrid" patternUnits="userSpaceOnUse" width="20" height="20">
                <rect id="gridFlowRect" width="10" height="20" fill="#ffffff"></rect>
                <animateTransform id="gridFlowAnim" attributeName="patternTransform" type="translate" from="40,0" to="0,0" dur="1s" repeatCount="indefinite"></animateTransform>
              </pattern>
              <pattern id="flowSolarV" patternUnits="userSpaceOnUse" width="20" height="20">
                    <rect id="solarFlowRectV" width="20" height="10" fill="#ffffff"></rect>
                    <animateTransform id="solarFlowAnimV" attributeName="patternTransform" type="translate" from="0,40" to="0,0" dur="1s" repeatCount="indefinite"></animateTransform>
              </pattern>
              <pattern id="flowSolarH" patternUnits="userSpaceOnUse" width="20" height="20">
                    <rect id="solarFlowRectH" width="10" height="20" fill="#ffffff"></rect>
                    <animateTransform id="solarFlowAnimH" attributeName="patternTransform" type="translate" from="40,0" to="0,0" dur="1s" repeatCount="indefinite"></animateTransform>
              </pattern>
              <pattern id="flowBatteryH" patternUnits="userSpaceOnUse" width="20" height="20">
                <rect id="batteryFlowRectH" width="10" height="20" fill="#ffffff"></rect>
                <animateTransform id="batteryFlowAnimH" attributeName="patternTransform" type="translate" from="40,0" to="0,0" dur="1s" repeatCount="indefinite"></animateTransform>
              </pattern>
              <pattern id="flowBatteryV" patternUnits="userSpaceOnUse" width="20" height="20">
                    <rect id="batteryFlowRectV" width="20" height="10" fill="#ffffff"></rect>
                    <animateTransform id="batteryFlowAnimV" attributeName="patternTransform" type="translate" from="0,0" to="0,40" dur="1s" repeatCount="indefinite"></animateTransform>
              </pattern>
            </defs>

            <!--Линия нагрузки-->
            <polyline points="320,200 530,200" fill="none" stroke="black" stroke-width="10" stroke-linejoin="round"></polyline>
            <polyline id="loadFlowLine" points="320,200 530,200" fill="none" stroke="url(#flowLoad)" stroke-width="6" stroke-linejoin="round"></polyline>
            <!--Линия сети-->
            <polyline points="20,200 165,200" fill="none" stroke="black" stroke-width="10" stroke-linejoin="round"></polyline>
            <polyline id="networkFlowLine" points="20,200 165,200" fill="none" stroke="url(#flowGrid)" stroke-width="6" stroke-linejoin="round"></polyline>
            <!--Линия солнечных панелей-->
            <polyline points="280,340 280,523" fill="none" stroke="black" stroke-width="10" stroke-linejoin="round"></polyline>
            <polyline points="280,518 460,518" fill="none" stroke="black" stroke-width="10" stroke-linejoin="round"></polyline>
            <polyline id="solarLineV" points="280,340 280,521" fill="none" stroke="url(#flowSolarV)" stroke-width="6" stroke-linejoin="round"></polyline>
            <polyline id="solarLineH" points="277,518 460,518" fill="none" stroke="url(#flowSolarH)" stroke-width="6" stroke-linejoin="round"></polyline>
            <!--Линия батарей-->
            <polyline points="200,340, 200,523" fill="none" stroke="black" stroke-width="10" stroke-linejoin="round"></polyline>
            <polyline points="200,518 65,518" fill="none" stroke="black" stroke-width="10" stroke-linejoin="round"></polyline>
            <polyline id="batteryLineV" points="200,340, 200,521" fill="none" stroke="url(#flowBatteryV)" stroke-width="6" stroke-linejoin="round"></polyline>
            <polyline id="batteryLineH" points="200,518 65,518" fill="none" stroke="url(#flowBatteryH)" stroke-width="6" stroke-linejoin="round"></polyline>       
          </svg>
        </div>  
       
</div>

       
       <!-- Контент вкладки Мониторинг -->
        <div id="monitor" class="tabcontent">
            <!-- Контейнер для графика -->
            <div id="chartContainer">
                <canvas id="powerChart"></canvas>

                <div id="chartLoadingOverlay" class="chart-loading-overlay" style="display: none;">
                    <div class="chart-loading-spinner"></div>
                    <span>Загрузка...</span>
                </div>
            </div>
            
            <!-- Блок управления периодом -->
            <div class="chart-controls">
                <div class="time-range-control">
                    <div class="chart-type-control">
                        <select id="chartTypeSelect">
                            <option value="line">Мощности (линия)</option>
                            <option value="bar">Энергия (столбцы)</option>
                        </select>
                    </div>

                    <label>Период:</label>
                    <select id="timeRangeSelect">
                        <option value="realtime">В реальном времени</option>
                        <option value="1h">Последний час</option>
                        <option value="3h">Последние 3 часа</option>
                        <option value="6h">Последние 6 часов</option>
                        <option value="12h">Последние 12 часов</option>
                        <option value="24h">Последние 24 часа</option>
                        <option value="3d">Последние 3 дня</option>
                        <option value="7d">Последние 7 дней</option>
                        <option value="30d">Последние 30 дней</option>
                        <option value="custom">Выбрать даты...</option>  
                    </select>
                    <div id="customDateRange" style="display: none;">
                        <input type="datetime-local" id="startDate">
                        <input type="datetime-local" id="endDate">
                        <button id="applyCustomRange" class="apply-button">Применить</button>
                    </div>

                    
                    <!-- Блок пагинации (только для реального времени) -->
                    <div class="pages-control" style="display: none;">
                        <label>Страниц на экран:</label>
                        <select id="pagesPerScreenSelect">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>  
                </div>
                
                <!-- Контейнер для суммарных энергий -->
                <div id="energyTotals" class="totals-container">
                    <div class="total-box">
                        <label>Солнечная генерация:</label>
                        <span id="totalSolar">0</span>
                    </div>
                    <div class="total-box">
                        <label>Нагрузка:</label>
                        <span id="totalLoad">0</span>
                    </div>
                    <div class="total-box">
                        <label>Импорт сети:</label>
                        <span id="totalGridImport">0</span>
                    </div>
                    <div class="total-box">
                        <label>Экспорт сети:</label>
                        <span id="totalGridExport">0</span>
                    </div>
                </div>
               
                
                <div class="time-range-slider-container" style="display: none;">
                    <input type="range" id="pageSlider" min="1" max="100" value="1" class="time-range-slider">
                    <div class="slider-labels">
                        <span>Страница 100</span>
                        <span>Страница 1</span>
                    </div>
                </div>
                
                <div class="time-display" style="display: none;">
                    <span id="currentPageDisplay">Текущая страница: 1</span>
                    <span id="loadingIndicator" style="display:none; margin-left:10px;">Загрузка...</span>
                </div>
            </div>
        </div>

        <!-- Контент вкладки Расписание -->
        <div id="timetable" class="tabcontent">
            <div class="schedule-controls">
                <button onclick="toggleSchedule()" id="toggleScheduleBtn" class="btn">Отключить расписание</button>
                <button onclick="addSchedulePeriod()" class="btn">+ Добавить период</button>
            </div>
            
            <div class="schedule-table-container">
                <table id="scheduleTable" class="schedule-table">
                    <thead>
                        <tr>
                            <th>№</th>
                            <th>Начало</th>
                            <th>Длительность</th>
                            <th>Конец</th>
                            <th>Отдача в сеть (Вт)</th>
                            <th>Уровень батареи (%)</th>
                            <th>Ток заряда(А)</th>
                            <th>Активен</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTableBody">
                        <!-- Строки будут добавляться динамически -->
                    </tbody>
                </table>
            </div>

            <div class="timeline-container">
                <div class="timeline">
                    <div class="timeline-ruler"></div>
                    <div class="timeline-periods" id="timelinePeriods"></div>
                </div>
                <div class="timeline-hours" id="timelineHours"></div>
            </div>
            

        </div>

       <!-- Контент вкладки Настройки -->
        <div id="settings" class="tabcontent">
            <div class="control-group">
                <p>Режим работы:</p>
                <p>Текущий режим работы: <span id="mode_display">...</span></p>
                <div class="control-group">
                    <label><input type="radio" name="mode" value="1" onchange="setMode(this)"> Charger Only</label>
                    <label><input type="radio" name="mode" value="2" onchange="setMode(this)"> Inverter Only</label>
                    <label><input type="radio" name="mode" value="3" onchange="setMode(this)"> On</label>
                    <label><input type="radio" name="mode" value="4" onchange="setMode(this)"> Off</label>
                </div>
              </div>
     

              <div style="margin: 12px 0;">
                <label for="gridLimitingSwitch" style="font-weight: bold;">Ограничение отдачи в сеть</label>
                <label class="switch">
                  <input type="checkbox" id="gridLimitingSwitch" onchange="handleGridLimitingToggle(this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              <button onclick="openRegistersModal()" class="btn" style="margin-top: 20px;">Регистры Modbus</button>
              <button id="process-excel-btn">Карта регистров</button>
              <div class="ess-settings-display">
                <h4>ESS расширенные настройки</h4>
                <table>
                    <tr><td>Setpoint AC:</td><td id="ac_setpoint">--</td></tr>
                    <tr><td>Setpoint (fine):</td><td id="fine_setpoint">--</td></tr>
                    <tr><td>Макс. заряд %:</td><td id="charge_limit">--</td></tr>
                    <tr><td>Макс. разряд %:</td><td id="discharge_limit">--</td></tr>
                    <tr><td>Ограничение по разряду (Вт):</td><td id="discharge_power">--</td></tr>
                    <tr><td>Макс. ток заряда (DC):</td><td id="dvcc_current">--</td></tr>
                    <tr><td>Ограничение Feed-in:</td><td id="feedin_power">--</td></tr>
                    <tr><td>Feed-in от DC-PV:</td><td id="feedin_dc">--</td></tr>
                    <tr><td>Feed-in от AC-PV:</td><td id="feedin_ac">--</td></tr>
                    <tr><td>Состояние Grid Limiting:</td><td id="grid_limit">--</td></tr>
                    <tr><td>Ограничение напряжения заряда:</td><td id="charge_voltage">--</td></tr>
                    <tr><td>Источник AC 1:</td><td id="input1_src">--</td></tr>
                    <tr><td>Источник AC 2:</td><td id="input2_src">--</td></tr>
                </table>
            </div>

        </div>
        
    </div>

       <!-- Модальные окна -->

        <!-- Модальное окно настроек батареи -->
        <div id="batteryModal" class="modal" style="display:none;">
            <div class="modal-header">
                <div class="modal-buttons">
                    <button class="modal-button close" data-action="close" id="closeBattery">✖</button>
                </div>
                <h3 style="margin-top:30; color:#291161;font-size: 17px;">Информация о батарее</h3>
            </div>   
            <p>Текущее напряжение, В: <span id="batt_voltage">0</span></p>
            <p>Ток заряда/разряда, A: <span id="batt_curr">0</span></p>
            <p>Уровень заряда, %: <span id="chargeLevel">0</span></p>
            <p>Мощность,Вт : <span id="PowerLevel">0</span></p>
            <p>Температура,: <span id="Bat_Temp">0</span>°C</p>
            <p>Порог разряда: <span id="vebusSOC">--</span> %</p>
 
              <!-- Ползунок для установки нижнего предела разряда батареи -->
            <div style="display: flex; align-items: center; gap: 10px;">
                <input type="range" id="State_Of_Сharge" min="0" max="99" step="1" value="40" style="width: 250px;">
                <span id="socSliderValue">40</span>%
            </div>
            <!-- Кнопка Сохранить -->
            <button id="saveBatteryButton" onclick="saveBatterySettings()" disabled>Сохранить</button>
            <div id="confirmationMessage" style="margin-bottom: 10px; color: rgb(11, 226, 11); display: none;"></div>             
        </div>

            <!-- Модальное окно параметров нагрузки -->
        <div id="loadSettingsModal" class="modal" style="display:none;">
            <div class="modal-header">
              <div class="modal-buttons">
                <button class="modal-button close" data-action="close" id="closeLoadSettings">✖</button>
               </div>
               <h3 style="margin-top:30; color:#291161;font-size: 17px;">Параметры нагрузки</h3>
            </div> 
                            
                <!-- Таблица с фазами -->
                <h3>Данные по фазам</h3>
                <table class="phase-table">
                    <thead>
                        <tr>
                            <th>Параметр</th>
                            <th>Фаза A</th>
                            <th>Фаза B</th>
                            <th>Фаза C</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Напряжение (В)</td>
                            <td id="outputVoltageL1">0</td>
                            <td id="outputVoltageL2">0</td>
                            <td id="outputVoltageL3">0</td>
                        </tr>
                        <tr>
                            <td>Частота (Гц)</td>
                            <td id="inputFrequencyL1">0</td>
                            <td id="inputFrequencyL2">0</td>
                            <td id="inputFrequencyL3">0</td>
                        </tr>
                        <tr>
                            <td>Ток (А)</td>
                            <td id="outputCurrentL1">0</td>
                            <td id="outputCurrentL2">0</td>
                            <td id="outputCurrentL3">0</td>
                        </tr>
                        <tr>
                            <td>Мощность (кВт)</td>
                            <td id="powerPhaseA">0</td>
                            <td id="powerPhaseB">0</td>
                            <td id="powerPhaseC">0</td>
                        </tr>
                    </tbody>
                </table>
                <!-- Суммарная мощность -->
                <p>Общая мощность нагрузки, КВт: <span id="total_load">0</span></p>
                 <!-- Кнопка Сохранить -->
                 <button id="saveLoadSettings" onclick="saveLoadSettings()">Сохранить</button>
                 <div id="loadConfirmationMessage" style="margin-top: 10px; color: rgb(11, 226, 11); display: none;"></div>
            
        </div>


        
            <!-- Модальное окно параметров сети -->
            <div id="GridSettingsModal" class="modal" style="display:none;">
                <div class="modal-header">
                  <div class="modal-buttons">
                    <button class="modal-button close" data-action="close" id="closeGridSettings">✖</button>
                   </div>
                   <h3 style="margin-top:30; color:#291161;font-size: 17px;">Параметры сети</h3>
                </div> 
                                
                    <!-- Таблица с фазами -->
                    <h3>Данные по фазам</h3>
                    <table class="phase-table">
                        <thead>
                            <tr>
                                <th>Параметр</th>
                                <th>Фаза A</th>
                                <th>Фаза B</th>
                                <th>Фаза C</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Напряжение (В)</td>
                                <td id="inputVoltageL1">0</td>
                                <td id="inputVoltageL2">0</td>
                                <td id="inputVoltageL3">0</td>
                            </tr>
                            <tr>
                                <td>Частота (Гц)</td>
                                <td id="inputFrequencyL1">0</td>
                                <td id="inputFrequencyL2">0</td>
                                <td id="inputFrequencyL3">0</td>
                            </tr>
                            <tr>
                                <td>Ток (А)</td>
                                <td id="inputCurrentL1">0</td>
                                <td id="inputCurrentL2">0</td>
                                <td id="inputCurrentL3">0</td>
                            </tr>
                            <tr>
                                <td>Мощность (кВт)</td>
                                <td id="inputPowerL1">0</td>
                                <td id="inputPowerL2">0</td>
                                <td id="inputPowerL3">0</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- Суммарная мощность  -->
                    <p>Общая мощность нагрузки, КВт: <span id="inputPowerTotal">0</span></p>
                        <label for="feedInPowerSlider" style="font-weight: bold;">Ограничение отдачи в сеть (Вт)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="range" id="feedInPowerSlider" min="-100000" max="100000" step="100" value="0" style="width: 250px;">
                            <span id="feedInSliderValue">0</span>
                        </div>
                        <button id="saveFeedInButton" onclick="saveAcSetpoint()" disabled>Сохранить</button>
                        <div id="feedInConfirmationMessage" style="margin-top: 10px; color: rgb(11, 226, 11); display: none;"></div>
            </div>

          <!--Модальное окно инвертора --> 
        <div id="inverterModal" class="modal" style="display:none;">
            <div class="modal-header">
                <div class="modal-buttons">
                  <button class="modal-button close" data-action="close" id="closeInverterModal">✖</button>
                 </div>
                 <h3 style="margin-top:30; color:#291161;font-size: 17px;">Информация о инверторе</h3>
            </div> 

            <label for="ChargingCurrentSlider" style="font-weight: bold;">Ток заряда MAX (A)</label>
            <div style="display: flex; align-items: center; gap: 10px;">
                <input type="range" id="ChargingCurrentSlider" min="0" max="3000" step="100" value="0" style="width: 250px;">
                <span id="ChargingSliderValue">0</span>
            </div>

            <label for="InverterPowerSlider" style="font-weight: bold;">Мощность инвертора (Вт)</label>
            <div style="display: flex; align-items: center; gap: 10px;">
                <input type="range" id="InverterPowerSlider" min="0" max="300000" step="100" value="0" style="width: 250px;">
                <span id="InverterSliderValue">0</span>
            </div>
            <button id="saveInverterPower" onclick="saveInverterPower()" disabled>Сохранить</button>
            <div id="InverterConfirmationMessage" style="margin-top: 10px; color: rgb(11, 226, 11); display: none;"></div>
           
        </div>

        <!-- Модальное окно Солнечных панелей -->
            <div id="SolarModal" class="modal" style="display:none; position: fixed; top: 10vh; left: 50%; transform: translateX(-50%); height: 40vh;  box-shadow: 0 0 15px rgba(0,0,0,0.2);  flex-direction: column;">

                <!-- Фиксированный заголовок -->
                <div class="modal-header" style=" padding: 1px;  position: sticky; top: 0; z-index: 10;">
                    <div class="modal-buttons" style="float: right;">
                        <button class="modal-button close" data-action="close" id="closeSolarModal">✖</button>
                    </div>
                    <h3 style="margin: 0; color:#291161; font-size: 17px;">Параметры панелей</h3>
                </div>
                <div class="cards-scroll-area" style="max-height:240px ;">
                <!-- Прокручиваемая часть -->
                <div id="solarTableContainer" style="overflow-y: auto; flex: 1 1 auto; padding: 10px;">
                    <!-- Таблицы добавляются динамически -->
                </div>
               </div>
                <!-- Фиксированная нижняя часть -->
                <div style="flex: 0 0 auto; padding: 30px;  position: sticky; bottom: 0;">
                    <p style="font-weight: bold;font-size: 16px; margin: 0;">🔆 Общая мощность MPPT: <span id="totalAllPower">0</span> Вт</p>
                </div>

                <!-- Шаблон таблицы -->
                <template id="solarTableTemplate">
                    <table class="phase-table" style="margin-bottom: 20px; width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr>
                                <th colspan="4" class="charger-title">MPPT</th>
                            </tr>
                            <tr>
                                <th>Панель</th>
                                <th>Напряжение (В)</th>
                                <th>Ток (А)</th>
                                <th>Мощность (Вт)</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            <!-- Строки панелей будут добавлены JS -->
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3"><strong>Итого по устройству</strong></td>
                                <td><strong class="device-total">0</strong> Вт</td>
                            </tr>
                        </tfoot>
                    </table>
                </template>
            </div>

                    <!-- Модальное окно чтения регистров -->
            <div id="RegistersModal" class="modal" style="display:none;">
                <div class="modal-header">
                    <div class="modal-buttons">
                        <button class="modal-button close" data-action="close" id="closeRegistersModal">✖</button>
                    </div>
                    <h3>Тестирование регистров Modbus</h3>
                </div>
                
                <div style="padding: 20px; display: flex; flex-direction: column; gap: 15px;">
                    <!-- Первая строка с тремя полями -->
                    <div style="display: flex; gap: 20px; width: 100%;">
                        <div style="flex: 1; min-width: 0;">
                            <label for="slave_id" style="display: block; margin-bottom: 5px;">Slave UID:</label>
                            <input type="number" id="slave_id" value="100" min="1" max="247" style="width: 100%; box-sizing: border-box;">
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <label for="start_reg" style="display: block; margin-bottom: 5px;">Начальный:</label>
                            <input type="number" id="start_reg" value="800" min="0" max="65535" style="width: 100%; box-sizing: border-box;">
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <label for="end_reg" style="display: block; margin-bottom: 5px;">Конечный:</label>
                            <input type="number" id="end_reg" value="830" min="0" max="65535" style="width: 100%; box-sizing: border-box;">
                        </div>
                    </div>
                    
                    <!-- Кнопка тестирования по центру -->
                    <div style="display: flex; justify-content: center;">
                        <button onclick="testRegisters()" class="btn" style="margin: 0 auto;">Тестировать</button>
                    </div>
                    
                    <!-- Вторая строка с двумя полями -->
                    <div style="display: flex; gap: 10px; width: 100%;">
                        <div style="flex: 1; min-width: 0;">
                            <label for="register_to_write" style="display: block; margin-bottom: 5px;">Регистр:</label>
                            <input type="number" id="register_to_write" min="0" max="65535" style="width: 100%; box-sizing: border-box;">
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <label for="register_value" style="display: block; margin-bottom: 5px;">Значение:</label>
                            <input type="number" id="register_value" min="0" max="65535" style="width: 100%; box-sizing: border-box;">
                        </div>
                    </div>
                    
                    <!-- Кнопка записи по центру -->
                    <div style="display: flex; justify-content: center;">
                        <button onclick="writeRegister()" class="btn" style="margin: 0 auto;">Записать</button>
                    </div>
                    <div id="register_results_output" class="modal-results" style="display: none;"></div>
                </div>
               
            </div>


                    <!-- Модальное окно карты регистров-->
            <div id="ExcelModal" class="modal"  style="display:none;">

                <div class="modal-header">
                    <div class="modal-buttons">
                        <button class="modal-button close" data-action="close" id="closeExelModal">✖</button>
                    </div>
                    <h3>Регистры Modbus</h3>
                </div>
                <div class="modal-content">
                    <div id="modal-loader" class="loader"></div>
                    <div id="excel-modal-content"></div>
                </div>
            </div>


        <script>
// Глобальные переменные
            let initialSocValue = 40;
            let socChangeTimeout = null;
            let isSliderChanged = false; // Флаг изменения ползунка

            let initialFeedInValue = 0;
            let feedInChangeTimeout = null;
            let isFeedInSliderChanged = false;

            let initialInverterPowerValue = 0;
            let inverterChangeTimeout = null;
            let inverterPowerChanged = false;

            let initialChargingCurrent = 0;
            let chargingChangeTimeout = null;
            let chargingCurrentChanged = false;
            
            let lastPowerValue = 0;

            let currentPage = 1;
            let pagesPerScreen = 1;
            let isLoading = false;
            let allMeasurements = [];
            let isSliderMoving = false;
            let powerChart = null;
            let chartUpdateInterval = null;

            let energyChart = null;
            let currentChartType = 'line';
            let currentBarTimeRange = '1d'; // по умолчанию сутки

            let scheduleEnabled = true;

            const lineTimeRanges = [
                { value: 'realtime', label: 'В реальном времени' },
                { value: '1h', label: 'Последний час' },
                { value: '3h', label: 'Последние 3 часа' },
                { value: '6h', label: 'Последние 6 часов' },
                { value: '12h', label: 'Последние 12 часов' },
                { value: '24h', label: 'Последние 24 часа' },
                { value: '3d', label: 'Последние 3 дня' },
                { value: '7d', label: 'Последние 7 дней' },
                { value: '30d', label: 'Последние 30 дней' },
                { value: 'custom', label: 'Выбрать даты...' }
            ];

            const barTimeRanges = [
                { value: 'today', label: 'За сегодня' },
                { value: 'this_week', label: 'За эту неделю' },
                { value: '1d', label: 'За сутки' },
                { value: '7d', label: 'За неделю' },
                { value: '30d', label: 'За месяц ' },
                { value: 'custom', label: 'Выбрать даты...' }
            ];



            let schedulePeriods = [
                // Пример данных
                {
                    id: 1,
                    startHour: 8,
                    startMinute: 0,
                    durationHour: 4,
                    durationMinute: 0,
                    feedIn: 2.5,
                    batteryLevel: 70,
                    chargeEnabled: true,
                    active: true
                },
                {
                    id: 2,
                    startHour: 14,
                    startMinute: 30,
                    durationHour: 2,
                    durationMinute: 30,
                    feedIn: 1.0,
                    batteryLevel: 50,
                    chargeEnabled: false,
                    active: true
                }
            ];

            const periodColors = [
                '#4CAF50', '#2196F3', '#FF9800', '#9C27B0', 
                '#E91E63', '#00BCD4', '#8BC34A', '#FF5722',
                '#607D8B', '#795548'
            ];

        const modeNames = {
            1: "Charger Only",
            2: "Inverter Only",
            3: "On",
            4: "Off"
            };

        let batteryData = {
            soc: 0,      // Уровень заряда (%)
            voltage: 0,  // Напряжение (В)
            current: 0,  // Ток (А)
            power: 0,    // Мощность (Вт)
            soh: 0       // Состояние здоровья батареи (%)
        };



        updateBatteryFill(batteryData.soc);
            // Закрытие модального окна (если нужно)
            document.getElementById("closeBattery").onclick = function() {
            document.getElementById("batteryModal").style.display = "none";
                }

            document.getElementById('feedInPowerSlider').addEventListener('input', function() {
            document.getElementById('feedInSliderValue').textContent = this.value;
            });
                    
// Обработчик изменения ползунка батареи
document.getElementById('State_Of_Сharge').addEventListener('input', function() {
    const newValue = this.value;
    const saveButton = document.getElementById('saveBatteryButton');
    document.getElementById('socSliderValue').textContent = newValue;
    
    isSliderChanged = true;
    
    // Сбрасываем предыдущий таймер, если он есть
    if (socChangeTimeout) {
        clearTimeout(socChangeTimeout);
    }
    saveButton.disabled = false; 
    // Устанавливаем новый таймер на 3 секунды
    socChangeTimeout = setTimeout(() => {
        resetSocSlider();
        showConfirmationMessage("Изменения не сохранены!!!", false);
    }, 4000);
});

      

// Обработчик изменения ползунка отдачи в сеть
document.getElementById('feedInPowerSlider').addEventListener('input', function() {
    const newValue = this.value;
    const saveButton = document.getElementById('saveFeedInButton');
    document.getElementById('feedInSliderValue').textContent = newValue;
    
    isFeedInSliderChanged = true;
    saveButton.disabled = false;
    
    // Сбрасываем предыдущий таймер, если он есть
    if (feedInChangeTimeout) {
        clearTimeout(feedInChangeTimeout);
    }
    
    // Устанавливаем новый таймер на 4 секунды
    feedInChangeTimeout = setTimeout(() => {
        resetFeedInSlider();
        showFeedInConfirmationMessage("Изменения не сохранены!!!", false);
    }, 4000);
});



document.getElementById('InverterPowerSlider').addEventListener('input', function () {
    const newValue = this.value;
    const saveButton = document.getElementById('saveInverterPower');
    document.getElementById('InverterSliderValue').textContent = newValue;

    inverterPowerChanged = true;
    saveButton.disabled = false;

    if (inverterChangeTimeout) {
        clearTimeout(inverterChangeTimeout);
    }

    inverterChangeTimeout = setTimeout(() => {
        resetInverterSlider();
        showInverterConfirmationMessage("Изменения не сохранены!!!", false);
    }, 4000);
});


document.getElementById('ChargingCurrentSlider').addEventListener('input', function () {
    const newValue = this.value;
    const saveButton = document.getElementById('saveInverterPower');
    document.getElementById('ChargingSliderValue').textContent = newValue;

    chargingCurrentChanged = true;
    saveButton.disabled = false;

    if (chargingChangeTimeout) {
        clearTimeout(chargingChangeTimeout);
    }

    chargingChangeTimeout = setTimeout(() => {
        resetChargingSlider();
        showInverterConfirmationMessage("Изменения тока заряда не сохранены!!!", false);
    }, 4000);
});


        </script>



<script>
  

function openTab(event, tabName) {
    var i, tabcontent, tabs;

    // Скрываем все вкладки
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
    }

    // Убираем активный класс с вкладок
    tabs = document.getElementsByClassName("tab");
    for (i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove("active");
    }

    // Показываем текущую вкладку
    document.getElementById(tabName).classList.add("active");
    event.currentTarget.classList.add("active");

    // 🔹 Если открыта вкладка Мониторинг → обновляем графики
    if (tabName === "monitor") {
        console.log("Обновление графика (вкладка Мониторинг)");
       // initChartTypeControl();

     
    }
}
	

// Функция для получения текущего времени в формате HH:MM:SS
function getCurrentTimeFormatted() {
    var now = new Date(); // Получаем текущее время

    var hours = now.getHours();   // Часы
    var minutes = now.getMinutes(); // Минуты
    var seconds = now.getSeconds(); // Секунды

    // Форматируем часы, минуты и секунды так, чтобы всегда было 2 цифры
    hours = hours < 10 ? '0' + hours : hours;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    seconds = seconds < 10 ? '0' + seconds : seconds;

    // Возвращаем строку в формате HH:MM:SS
    return hours + ':' + minutes + ':' + seconds;
}



  
        // Функция для открытия модального окна подтверждения переключения режима
        function openModeConfirmation(mode) {
            var modal = document.getElementById('modeConfirmationModal');
            modal.style.display = 'flex';
            modal.dataset.mode = mode; // Сохраняем режим переключения
        }

 
  
  let tick = 0;
     // Обновим интервал обновления
     setInterval(() => {
        tick++;
        
        if (tick % 33 === 0) fetchSolarChargerStatus();
        if (tick % 3 === 0) fetchInverterPowerStatus();
        if (tick % 4 === 0) fetchEssAcStatus();
        if (tick % 5 === 0) fetchVebusStatus();
        if (tick % 6 === 0) fetchEss();
        if (tick % 7 === 0) fetchEssAdvancedSettings();
        if (tick % 9 === 0) fetchStatus();
        if (tick % 10 === 0) fetchSolarChargersSum();
        if (tick % 30 === 0) checkConnectionStatus();
        if (tick % 11 === 0) fetchDynamicEssSettings();
        if (tick >= 60) tick = 0;
      }, 100);
    
        // Первая загрузка
        fetchEss();
        fetchStatus();
        fetchInverterPowerStatus();
        fetchEssAcStatus();
        fetchVebusStatus(); 
        fetchEssAdvancedSettings();
        fetchSolarChargerStatus();
        fetchSolarChargersSum();
        checkConnectionStatus();
        fetchDynamicEssSettings();
    </script>
    
</body>
</html>